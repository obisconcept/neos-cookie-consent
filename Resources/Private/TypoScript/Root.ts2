namespace: Ts=TYPO3.TypoScript

prototype(Page) {
  head.cookieConsent = Ts:Template {
    templatePath = 'resource://obisconcept.neoscookieconsent/Private/Templates/TypoScriptObjects/Initialize.html'

    scriptTag = Ts:Tag {
      tagName = 'script'
      attributes {
        type = 'text/javascript'
        src = Ts:ResourceUri {
          path = 'JavaScript/cookieconsent.min.js'
          package = 'obisconcept.neoscookieconsent'
        }
      }

      @if.includeJavaScript = ${Configuration.setting('ObisConcept.CookieConsent.includeJavaScript')}
    }

    styleTag = Ts:Tag {
      tagName = 'link'
      attributes {
        rel = 'stylesheet'
        type = 'text/css'
        href = Ts:ResourceUri {
          path = 'Stylesheets/cookieconsent.min.css'
          package = 'obisconcept.neoscookieconsent'
        }
      }

      @if.includeCss = ${Configuration.setting('ObisConcept.CookieConsent.includeCss')}
    }

    @context.translationSource = ${Configuration.setting('ObisConcept.CookieConsent.translations.source')}
    @context.translationPackage = ${Configuration.setting('ObisConcept.CookieConsent.translations.package')}

    settings = Ts:RawArray {
      position = ${Configuration.setting('ObisConcept.CookieConsent.position')}
      theme = ${Configuration.setting('ObisConcept.CookieConsent.theme')}
      palette = ${Configuration.setting('ObisConcept.CookieConsent.palette')}
      content = Ts:RawArray {
        message = ${Translation.translate('message', null, [], translationSource, translationPackage)}
        dismiss = ${Translation.translate('dismiss', null, [], translationSource, translationPackage)}
        link = ${Translation.translate('link-text', null, [], translationSource, translationPackage)}

        href = NodeUri {
          node = ${q(site).find('#' + Configuration.setting('ObisConcept.CookieConsent.policyPageNode')).get(0)}
          absolute = true

          @if.isset = ${String.isBlank(Configuration.setting('ObisConcept.CookieConsent.policyPageNode')) == false}
        }
      }

      @process.json = ${Json.stringify(value)}
    }

    @if.enabled = ${Configuration.setting('ObisConcept.CookieConsent.enable') == true}
    @if.inFrontend = ${site.context.inBackend == false}
  }
}
